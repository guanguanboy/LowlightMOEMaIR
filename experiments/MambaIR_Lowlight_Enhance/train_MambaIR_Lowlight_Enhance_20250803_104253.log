2025-08-03 10:42:53,985 INFO: 
                ____                _       _____  ____
               / __ ) ____ _ _____ (_)_____/ ___/ / __ \
              / __  |/ __ `// ___// // ___/\__ \ / /_/ /
             / /_/ // /_/ /(__  )/ // /__ ___/ // _, _/
            /_____/ \__,_//____//_/ \___//____//_/ |_|
     ______                   __   __                 __      __
    / ____/____   ____   ____/ /  / /   __  __ _____ / /__   / /
   / / __ / __ \ / __ \ / __  /  / /   / / / // ___// //_/  / /
  / /_/ // /_/ // /_/ // /_/ /  / /___/ /_/ // /__ / /<    /_/
  \____/ \____/ \____/ \____/  /_____/\____/ \___//_/|_|  (_)
    
Version Information: 
	BasicSR: 1.2.0+863ca48
	PyTorch: 2.3.1+cu118
	TorchVision: 0.18.1+cu118
2025-08-03 10:42:53,986 INFO: 
  name: MambaIR_Lowlight_Enhance
  model_type: MambaIRv2Model
  scale: 1
  num_gpu: 4
  manual_seed: 100
  datasets:[
    train:[
      name: TrainSet
      type: PairedImageDataset
      dataroot_gt: /data/lgl/datasets/LowLight/LOL-v1/our485/high
      dataroot_lq: /data/lgl/datasets/LowLight/LOL-v1/our485/low
      geometric_augs: True
      filename_tmpl: {}
      io_backend:[
        type: disk
      ]
      use_hflip: True
      use_rot: True
      use_shuffle: True
      num_worker_per_gpu: 0
      batch_size_per_gpu: 1
      mini_batch_sizes: [8]
      iters: [300000]
      gt_size: 128
      gt_sizes: [128]
      dataset_enlarge_ratio: 100
      prefetch_mode: None
      phase: train
      scale: 1
    ]
    val:[
      name: ValSet
      type: PairedImageDataset
      dataroot_gt: /data/lgl/datasets/LowLight/LOL-v1/eval15/high
      dataroot_lq: /data/lgl/datasets/LowLight/LOL-v1/eval15/high
      io_backend:[
        type: disk
      ]
      phase: val
      scale: 1
    ]
  ]
  network_g:[
    type: MambaIRv2
    upscale: 1
    in_chans: 3
    img_size: 128
    img_range: 1.0
    embed_dim: 174
    d_state: 16
    depths: [6, 6, 6, 6, 6, 6]
    num_heads: [6, 6, 6, 6, 6, 6]
    window_size: 16
    inner_rank: 64
    num_tokens: 128
    convffn_kernel_size: 5
    mlp_ratio: 2.0
  ]
  path:[
    pretrain_network_g: None
    strict_load_g: True
    resume_state: None
    experiments_root: /data/lgl/codes/MambaIR/experiments/MambaIR_Lowlight_Enhance
    models: /data/lgl/codes/MambaIR/experiments/MambaIR_Lowlight_Enhance/models
    training_states: /data/lgl/codes/MambaIR/experiments/MambaIR_Lowlight_Enhance/training_states
    log: /data/lgl/codes/MambaIR/experiments/MambaIR_Lowlight_Enhance
    visualization: /data/lgl/codes/MambaIR/experiments/MambaIR_Lowlight_Enhance/visualization
  ]
  train:[
    total_iter: 300000
    warmup_iter: -1
    use_grad_clip: True
    scheduler:[
      type: MultiStepLR
      milestones: [125000, 200000, 225000, 237500]
      gamma: 0.5
    ]
    optim_g:[
      type: Adam
      lr: 0.0003
      weight_decay: 0.0001
      betas: [0.9, 0.999]
    ]
    pixel_opt:[
      type: L1Loss
      loss_weight: 1
      reduction: mean
    ]
  ]
  val:[
    window_size: 8
    val_freq: 4000.0
    save_img: False
    rgb2bgr: True
    use_image: False
    max_minibatch: 8
    metrics:[
      psnr:[
        type: calculate_psnr
        crop_border: 0
        test_y_channel: False
      ]
    ]
  ]
  logger:[
    print_freq: 1000
    save_checkpoint_freq: 4000.0
    use_tb_logger: True
    wandb:[
      project: None
      resume_id: None
    ]
  ]
  dist_params:[
    backend: nccl
    port: 29500
  ]
  dist: True
  rank: 0
  world_size: 4
  auto_resume: False
  is_train: True
  root_path: /data/lgl/codes/MambaIR

2025-08-03 10:42:54,117 INFO: Dataset [PairedImageDataset] - TrainSet is built.
2025-08-03 10:42:54,118 INFO: Training statistics:
	Number of train images: 485
	Dataset enlarge ratio: 100
	Batch size per gpu: 1
	World size (gpu number): 4
	Require iter number per epoch: 12125
	Total epochs: 25; iters: 300000.
2025-08-03 10:42:54,118 INFO: Dataset [PairedImageDataset] - ValSet is built.
2025-08-03 10:42:54,118 INFO: Number of val images/folders in ValSet: 15
2025-08-03 10:42:54,562 INFO: Network [MambaIRv2] is created.
2025-08-03 10:42:55,205 INFO: Network: DistributedDataParallel - MambaIRv2, with parameters: 22,657,971
2025-08-03 10:42:55,205 INFO: MambaIRv2(
  (conv_first): Conv2d(3, 174, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))
  (patch_embed): PatchEmbed(
    (norm): LayerNorm((174,), eps=1e-05, elementwise_affine=True)
  )
  (patch_unembed): PatchUnEmbed()
  (layers): ModuleList(
    (0-5): 6 x ASSB(
      (patch_embed): PatchEmbed()
      (patch_unembed): PatchUnEmbed()
      (residual_group): BasicBlock(
        dim=174, input_resolution=(128, 128), depth=6
        (layers): ModuleList(
          (0-5): 6 x AttentiveLayer(
            (softmax): Softmax(dim=-1)
            (lrelu): LeakyReLU(negative_slope=0.01)
            (sigmoid): Sigmoid()
            (norm1): LayerNorm((174,), eps=1e-05, elementwise_affine=True)
            (norm2): LayerNorm((174,), eps=1e-05, elementwise_affine=True)
            (norm3): LayerNorm((174,), eps=1e-05, elementwise_affine=True)
            (norm4): LayerNorm((174,), eps=1e-05, elementwise_affine=True)
            (wqkv): Linear(in_features=174, out_features=522, bias=True)
            (win_mhsa): WindowAttention(
              dim=174, window_size=(16, 16), num_heads=6, qkv_bias=True
              (proj): Linear(in_features=174, out_features=174, bias=True)
              (softmax): Softmax(dim=-1)
            )
            (assm): ASSM(
              (selectiveScan): Selective_Scan()
              (out_norm): LayerNorm((348,), eps=1e-05, elementwise_affine=True)
              (act): SiLU()
              (out_proj): Linear(in_features=348, out_features=174, bias=True)
              (in_proj): Sequential(
                (0): Conv2d(174, 348, kernel_size=(1, 1), stride=(1, 1))
              )
              (CPE): Sequential(
                (0): Conv2d(348, 348, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), groups=348)
              )
              (embeddingB): Embedding(128, 64)
              (route): Sequential(
                (0): Linear(in_features=174, out_features=58, bias=True)
                (1): GELU(approximate='none')
                (2): Linear(in_features=58, out_features=128, bias=True)
                (3): LogSoftmax(dim=-1)
              )
            )
            (convffn1): ConvFFN(
              (fc1): Linear(in_features=174, out_features=348, bias=True)
              (act): GELU(approximate='none')
              (dwconv): dwconv(
                (depthwise_conv): Sequential(
                  (0): Conv2d(348, 348, kernel_size=(5, 5), stride=(1, 1), padding=(2, 2), groups=348)
                  (1): GELU(approximate='none')
                )
              )
              (fc2): Linear(in_features=348, out_features=174, bias=True)
            )
            (convffn2): ConvFFN(
              (fc1): Linear(in_features=174, out_features=348, bias=True)
              (act): GELU(approximate='none')
              (dwconv): dwconv(
                (depthwise_conv): Sequential(
                  (0): Conv2d(348, 348, kernel_size=(5, 5), stride=(1, 1), padding=(2, 2), groups=348)
                  (1): GELU(approximate='none')
                )
              )
              (fc2): Linear(in_features=348, out_features=174, bias=True)
            )
            (embeddingA): Embedding(64, 16)
          )
        )
      )
      (conv): Conv2d(174, 174, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))
    )
  )
  (norm): LayerNorm((174,), eps=1e-05, elementwise_affine=True)
  (conv_after_body): Conv2d(174, 174, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))
  (conv_last): Conv2d(174, 3, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))
)
2025-08-03 10:42:55,210 INFO: Loss [L1Loss] is created.
2025-08-03 10:42:55,216 INFO: Model [MambaIRv2Model] is created.
2025-08-03 10:42:55,217 INFO: Start training from epoch: 0, iter: 0
2025-08-03 10:58:39,395 INFO: [Mamba..][epoch:  0, iter:   1,000, lr:(3.000e-04,)] [eta: 3 days, 6:08:16, time (data): 0.943 (0.015)] l_pix: 1.2586e-01 
2025-08-03 11:14:21,674 INFO: [Mamba..][epoch:  0, iter:   2,000, lr:(3.000e-04,)] [eta: 3 days, 5:56:16, time (data): 0.940 (0.015)] l_pix: 1.2115e-01 
2025-08-03 11:30:00,207 INFO: [Mamba..][epoch:  0, iter:   3,000, lr:(3.000e-04,)] [eta: 3 days, 5:35:37, time (data): 0.937 (0.015)] l_pix: 1.3183e-01 
2025-08-03 11:45:32,872 INFO: [Mamba..][epoch:  0, iter:   4,000, lr:(3.000e-04,)] [eta: 3 days, 5:10:15, time (data): 0.932 (0.015)] l_pix: 2.6324e-01 
2025-08-03 11:45:32,873 INFO: Saving models and training states.
2025-08-03 11:47:26,897 INFO: Validation ValSet
	 # psnr: 5.2332	Best: 5.2332 @ 4000 iter

2025-08-03 12:02:57,773 INFO: [Mamba..][epoch:  0, iter:   5,000, lr:(3.000e-04,)] [eta: 3 days, 6:39:09, time (data): 0.932 (0.014)] l_pix: 1.1765e-01 
2025-08-03 12:18:28,920 INFO: [Mamba..][epoch:  0, iter:   6,000, lr:(3.000e-04,)] [eta: 3 days, 5:59:43, time (data): 0.929 (0.014)] l_pix: 1.6619e-01 
2025-08-03 12:33:58,905 INFO: [Mamba..][epoch:  0, iter:   7,000, lr:(3.000e-04,)] [eta: 3 days, 5:26:19, time (data): 0.931 (0.014)] l_pix: 1.3096e-01 
2025-08-03 12:49:26,780 INFO: [Mamba..][epoch:  0, iter:   8,000, lr:(3.000e-04,)] [eta: 3 days, 4:56:07, time (data): 0.924 (0.014)] l_pix: 1.7702e-01 
2025-08-03 12:49:26,781 INFO: Saving models and training states.
2025-08-03 12:51:20,257 INFO: Validation ValSet
	 # psnr: 5.1078	Best: 5.2332 @ 4000 iter

2025-08-03 13:06:43,335 INFO: [Mamba..][epoch:  0, iter:   9,000, lr:(3.000e-04,)] [eta: 3 days, 5:27:44, time (data): 0.922 (0.014)] l_pix: 2.6984e-01 
2025-08-03 13:22:06,120 INFO: [Mamba..][epoch:  0, iter:  10,000, lr:(3.000e-04,)] [eta: 3 days, 4:54:36, time (data): 0.922 (0.014)] l_pix: 2.4661e-01 
2025-08-03 13:37:28,670 INFO: [Mamba..][epoch:  0, iter:  11,000, lr:(3.000e-04,)] [eta: 3 days, 4:24:35, time (data): 0.920 (0.014)] l_pix: 8.6657e-02 
2025-08-03 13:52:48,914 INFO: [Mamba..][epoch:  0, iter:  12,000, lr:(3.000e-04,)] [eta: 3 days, 3:56:06, time (data): 0.918 (0.014)] l_pix: 1.2155e-01 
2025-08-03 13:52:48,915 INFO: Saving models and training states.
2025-08-03 13:54:41,755 INFO: Validation ValSet
	 # psnr: 6.6865	Best: 6.6865 @ 12000 iter

2025-08-03 14:09:59,569 INFO: [Mamba..][epoch:  1, iter:  13,000, lr:(3.000e-04,)] [eta: 3 days, 4:10:15, time (data): 0.919 (0.014)] l_pix: 9.8191e-02 
2025-08-03 14:25:18,206 INFO: [Mamba..][epoch:  1, iter:  14,000, lr:(3.000e-04,)] [eta: 3 days, 3:41:47, time (data): 0.917 (0.014)] l_pix: 1.7226e-01 
2025-08-03 14:40:37,711 INFO: [Mamba..][epoch:  1, iter:  15,000, lr:(3.000e-04,)] [eta: 3 days, 3:15:21, time (data): 0.918 (0.014)] l_pix: 9.8295e-02 
2025-08-03 14:55:56,575 INFO: [Mamba..][epoch:  1, iter:  16,000, lr:(3.000e-04,)] [eta: 3 days, 2:50:07, time (data): 0.919 (0.014)] l_pix: 1.1447e-01 
2025-08-03 14:55:56,576 INFO: Saving models and training states.
2025-08-03 14:57:49,373 INFO: Validation ValSet
	 # psnr: 6.3741	Best: 6.6865 @ 12000 iter

2025-08-03 15:13:07,098 INFO: [Mamba..][epoch:  1, iter:  17,000, lr:(3.000e-04,)] [eta: 3 days, 2:57:02, time (data): 0.919 (0.014)] l_pix: 1.7627e-01 
2025-08-03 15:28:27,734 INFO: [Mamba..][epoch:  1, iter:  18,000, lr:(3.000e-04,)] [eta: 3 days, 2:32:35, time (data): 0.922 (0.014)] l_pix: 9.8358e-02 
2025-08-03 15:43:48,170 INFO: [Mamba..][epoch:  1, iter:  19,000, lr:(3.000e-04,)] [eta: 3 days, 2:09:02, time (data): 0.919 (0.014)] l_pix: 1.3792e-01 
2025-08-03 15:59:06,251 INFO: [Mamba..][epoch:  1, iter:  20,000, lr:(3.000e-04,)] [eta: 3 days, 1:45:46, time (data): 0.919 (0.014)] l_pix: 1.2381e-01 
2025-08-03 15:59:06,252 INFO: Saving models and training states.
2025-08-03 16:00:59,098 INFO: Validation ValSet
	 # psnr: 6.0383	Best: 6.6865 @ 12000 iter

2025-08-03 16:16:17,699 INFO: [Mamba..][epoch:  1, iter:  21,000, lr:(3.000e-04,)] [eta: 3 days, 1:48:21, time (data): 0.922 (0.014)] l_pix: 1.0484e-01 
2025-08-03 16:31:39,888 INFO: [Mamba..][epoch:  1, iter:  22,000, lr:(3.000e-04,)] [eta: 3 days, 1:26:07, time (data): 0.925 (0.014)] l_pix: 5.5206e-02 
2025-08-03 16:47:05,627 INFO: [Mamba..][epoch:  1, iter:  23,000, lr:(3.000e-04,)] [eta: 3 days, 1:05:13, time (data): 0.927 (0.014)] l_pix: 5.3115e-01 
2025-08-03 17:02:31,383 INFO: [Mamba..][epoch:  1, iter:  24,000, lr:(3.000e-04,)] [eta: 3 days, 0:44:45, time (data): 0.925 (0.014)] l_pix: 1.7954e-01 
2025-08-03 17:02:31,384 INFO: Saving models and training states.
2025-08-03 17:04:24,254 INFO: Validation ValSet
	 # psnr: 6.0226	Best: 6.6865 @ 12000 iter

2025-08-03 17:19:45,188 INFO: [Mamba..][epoch:  2, iter:  25,000, lr:(3.000e-04,)] [eta: 3 days, 0:44:31, time (data): 0.920 (0.014)] l_pix: 2.2634e-01 
2025-08-03 17:35:05,094 INFO: [Mamba..][epoch:  2, iter:  26,000, lr:(3.000e-04,)] [eta: 3 days, 0:22:58, time (data): 0.920 (0.014)] l_pix: 1.6679e-01 
2025-08-03 17:50:25,499 INFO: [Mamba..][epoch:  2, iter:  27,000, lr:(3.000e-04,)] [eta: 3 days, 0:01:57, time (data): 0.920 (0.014)] l_pix: 1.5892e-01 
2025-08-03 18:05:44,951 INFO: [Mamba..][epoch:  2, iter:  28,000, lr:(3.000e-04,)] [eta: 2 days, 23:41:12, time (data): 0.920 (0.014)] l_pix: 1.2697e-01 
2025-08-03 18:05:44,953 INFO: Saving models and training states.
2025-08-03 18:07:38,286 INFO: Validation ValSet
	 # psnr: 6.0129	Best: 6.6865 @ 12000 iter

2025-08-03 18:22:57,098 INFO: [Mamba..][epoch:  2, iter:  29,000, lr:(3.000e-04,)] [eta: 2 days, 23:38:22, time (data): 0.918 (0.014)] l_pix: 1.1935e-01 
2025-08-03 18:38:16,038 INFO: [Mamba..][epoch:  2, iter:  30,000, lr:(3.000e-04,)] [eta: 2 days, 23:17:35, time (data): 0.918 (0.014)] l_pix: 1.7593e-01 
2025-08-03 18:53:34,960 INFO: [Mamba..][epoch:  2, iter:  31,000, lr:(3.000e-04,)] [eta: 2 days, 22:57:10, time (data): 0.921 (0.014)] l_pix: 1.3500e-01 
2025-08-03 19:08:53,499 INFO: [Mamba..][epoch:  2, iter:  32,000, lr:(3.000e-04,)] [eta: 2 days, 22:37:01, time (data): 0.916 (0.014)] l_pix: 1.4224e-01 
2025-08-03 19:08:53,500 INFO: Saving models and training states.
2025-08-03 19:10:46,400 INFO: Validation ValSet
	 # psnr: 6.0896	Best: 6.6865 @ 12000 iter

2025-08-03 19:26:03,500 INFO: [Mamba..][epoch:  2, iter:  33,000, lr:(3.000e-04,)] [eta: 2 days, 22:32:11, time (data): 0.919 (0.014)] l_pix: 1.4105e-01 
2025-08-03 19:41:22,889 INFO: [Mamba..][epoch:  2, iter:  34,000, lr:(3.000e-04,)] [eta: 2 days, 22:12:12, time (data): 0.919 (0.014)] l_pix: 2.0581e-01 
